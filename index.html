<!DOCTYPE html>

<html>
<head>
    <title>Simple Code Analyzer</title>
    <link rel="stylesheet" href="analyzer/analyzer.css">
    <script src="external/jquery.min.js"></script>
    <script src="external/underscore.min.js"></script>
    <script src="external/esprima.js"></script>
    <script src="external/ace-orig.js" type="text/javascript" charset="utf-8"></script>
    <script src="external/ace-mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script src="external/ace-worker-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script src="analyzer/analyzer.js"></script>
</head>
<body>
  <div id="container">
    <div class="page-label">Simple Code Analyzer</div>
    <div class="summary">
        <p><strong>Simple Code Analyzer</strong> is a (very) simple tool that checks for the presence of required code elements and structure.</p>
        <p>The tool's organization and layout is based on <a href="http://khan.github.io/structuredjs/">structured.js</a> by Sophia Westwood.</p>
        <p>Required elements are specified using JSON. For example, the following array indicates that a For Statement is required. It is also required that a variable should NOT be declared within a For Statement</p>
        <pre>
{
    "required": [
        {
            "description": "Use a for statement",
            "pattern": "ForStatement"
        },
        {
            "description": "Don't declare a variable inside a for statement",
            "pattern": "ForStatement/VariableDeclaration",
            "exclude": true
        }
    ]
}
        </pre>
        <p>The user's code is checked automatically as it is typed.  The analysis process is as follows:</p>
        <ul class="summary-list">
            <li>The requirements JSON is parsed, generating a list of patterns that must (or must not) be matched.</li>
            <ul><li>If the "exclude" property is set, the pattern must NOT be matched.</li></ul>
            <li>Then the user's code is parsed by Esprima to generate an Abstract Syntax Tree (AST).</li>
            <li>The AST is traversed to generate a "path" to each leaf node of the AST tree.</li>
            <ul><li>i.e. The path to a top level For Statement is: /Program/ForStatement</li></ul>
            <li>Each path is checked against the list of required patterns.</li>
            <li>If a required pattern matches a path (or is contained in a path) that requirement is satisfied.</li>
            <ul><li>Note: A path may satisfy more that one requirement.</li></ul>
            <li>Finally, the UI is updated to reflect the status of satisfied requirements.</li>
        </ul>

      <p>Try it out!</p>
    </div>

    <div class="editor-labels">
      <span class="required-elements-label">Required elements</span>
      <span class="code-label">Code to check</span>
    </div>
      
<div id="required-elements" class="code-editor">{
    "required": [
        {
            "description": "Declare a variable",
            "pattern": "VariableDeclaration"
        },
        {
            "description": "Test a value using a binary expression",
            "pattern": "BinaryExpression"
        },
        {
            "description": "Use a for statement",
            "pattern": "ForStatement"
        },
        {
            "description": "Don't declare a variable inside a for statement",
            "pattern": "ForStatement/VariableDeclaration",
            "exclude": true
        },
        {
            "description": "Assign a value to a variable inside a for loop body",
            "pattern": "ForStatement/BlockStatement/ExpressionStatement/AssignmentExpression"
        }
    ]
}
</div>

<div id="test-code" class="code-editor">var x = 0;
for (var i = 0; i < 99; i += 1) {
 x += i;
}
</div>

<div class="editor-labels">
    <span class="ast-esprima-label">AST (esprima)</span>
    <!-- <span class="ast-esprima-generate"><small>generate ast</small></span> -->
</div>
<div id="ast-esprima" class="code-editor">// AST generated by esprima

</div>

  <div id="result-wrapper">
    <button id="run-button">Check match</button>
    <div id="results">
        (Match result here)
    </div>
    <div class="match-fail-message">
      (Fail message here)
    </div>
      <div id="required-elements-status">
          <ul>
          <li>[  ] Required element</li>
          </ul>
      </div>
  </div>

<div class="editor-labels">
<span class="ast-esprima-label">Code Element Paths</span>
</div>
<div id="code-element-paths" class="code-editor">Element Paths
</div>

</div>
<footer>Based on <a href="http://khan.github.io/structuredjs/">structured.js</a> by Sophia Westwood, <a href="https://www.khanacademy.org/cs">Khan Academy CS</a></footer>
</body>
</html>
